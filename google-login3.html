<html>
  <body>
    <h1>YouTube API Demo</h1>

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Login Button -->
    <div id="g_id_onload"
         data-client_id="494753670710-1bdnjbifije3cckvbmm29lv9n9okh9qt.apps.googleusercontent.com"
         data-scope="https://www.googleapis.com/auth/youtube.force-ssl"
         data-callback="handleCredentialResponse">
    </div>
    <div class="g_id_signin" data-type="standard"></div>

    <div>
      <button onclick="fetchComments()">Kommentare abrufen</button>
    </div>
    <div id="comments"></div>

    <script>
      let accessToken = null;

      function handleCredentialResponse(response) {
        // Google Identity Services liefert ein ID-Token, wir benötigen aber ein Access Token
        const params = new URLSearchParams();
        params.append("client_id", "494753670710-1bdnjbifije3cckvbmm29lv9n9okh9qt.apps.googleusercontent.com");
        params.append("grant_type", "authorization_code");
        params.append("code", response.credential);
        params.append("redirect_uri", "postmessage");

        fetch("https://oauth2.googleapis.com/token", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: params,
        })
          .then((res) => res.json())
          .then((data) => {
            accessToken = data.access_token;
            console.log("Access Token erhalten:", accessToken);
            alert("Login erfolgreich!");
          })
          .catch((error) => console.error("Fehler beim Abrufen des Access Tokens:", error));
      }

      // Kommentare abrufen
      async function fetchComments() {
        const videoId = prompt("Bitte die Video-ID eingeben:");
        if (!accessToken) {
          alert("Bitte zuerst anmelden.");
          return;
        }

        const response = await fetch(`https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&maxResults=10`, {
          method: "GET",
          headers: {
            Authorization: `Bearer ${accessToken}`,
          },
        });
        const comments = await response.json();

        // Kommentare anzeigen
        const commentsDiv = document.getElementById("comments");
        commentsDiv.innerHTML = "<h2>Kommentare:</h2>";
        comments.items.forEach((comment) => {
          const commentHtml = `
            <div>
              <p><b>${comment.snippet.topLevelComment.snippet.authorDisplayName}:</b> ${comment.snippet.topLevelComment.snippet.textOriginal}</p>
              <button onclick="deleteComment('${comment.id}')">Löschen</button>
            </div>
          `;
          commentsDiv.innerHTML += commentHtml;
        });
      }

      // Kommentar löschen
      async function deleteComment(commentId) {
        if (!accessToken) {
          alert("Bitte zuerst anmelden.");
          return;
        }

        const response = await fetch(`https://www.googleapis.com/youtube/v3/comments?id=${commentId}`, {
          method: "DELETE",
          headers: {
            Authorization: `Bearer ${accessToken}`,
          },
        });
        if (response.ok) {
          alert("Kommentar gelöscht!");
          fetchComments();
        } else {
          alert("Fehler beim Löschen des Kommentars.");
        }
      }
    </script>
  </body>
</html>
